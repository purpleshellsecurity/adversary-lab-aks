# ============================================================================
# AKS Adversary Lab - Namespace Definitions
# Pod Security Admission (PSA) labels enforce security profiles per namespace
# ============================================================================

---
# Attacker namespace: privileged PSA — allows all pod configurations
# Red team tools need hostPath, privileged containers, host networking
apiVersion: v1
kind: Namespace
metadata:
  name: attacker
  labels:
    adversary-lab/role: "red-team"
    pod-security.kubernetes.io/enforce: "privileged"
    pod-security.kubernetes.io/enforce-version: "latest"
    pod-security.kubernetes.io/audit: "privileged"
    pod-security.kubernetes.io/warn: "baseline"  # Warn on baseline violations
  annotations:
    adversary-lab/description: "Offensive security tools — kdigger, CDK, Peirates, kubectl, nmap, curler"
    adversary-lab/mitre-tactics: "All tactics — attack origin namespace"

---
# Victim namespace: baseline PSA — standard Kubernetes defaults
# Intentionally weaker security to test detection capabilities
apiVersion: v1
kind: Namespace
metadata:
  name: victim
  labels:
    adversary-lab/role: "target"
    pod-security.kubernetes.io/enforce: "baseline"
    pod-security.kubernetes.io/enforce-version: "latest"
    pod-security.kubernetes.io/audit: "restricted"   # Audit against restricted
    pod-security.kubernetes.io/warn: "restricted"     # Warn on restricted violations
  annotations:
    adversary-lab/description: "Vulnerable workloads — DVWA, misconfigured APIs, exposed services"
    adversary-lab/mitre-tactics: "Initial Access, Execution, Impact targets"

---
# Monitoring namespace: restricted PSA — strictest security profile
# Falco, Tracee, Prometheus, Grafana, custom exporters
apiVersion: v1
kind: Namespace
metadata:
  name: monitoring
  labels:
    adversary-lab/role: "blue-team"
    pod-security.kubernetes.io/enforce: "privileged"  # Falco/Tracee need host access for eBPF
    pod-security.kubernetes.io/enforce-version: "latest"
    pod-security.kubernetes.io/audit: "baseline"
    pod-security.kubernetes.io/warn: "baseline"
  annotations:
    adversary-lab/description: "Detection and monitoring tools — Falco, Tracee, Tetragon, Prometheus"
    adversary-lab/mitre-tactics: "Defense Evasion detection (T1562.001 targets this namespace)"

---
# Security tools namespace: restricted PSA
# Kubescape, rbac-police, kubectl-who-can, scanning tools
apiVersion: v1
kind: Namespace
metadata:
  name: security-tools
  labels:
    adversary-lab/role: "assessment"
    pod-security.kubernetes.io/enforce: "restricted"
    pod-security.kubernetes.io/enforce-version: "latest"
    pod-security.kubernetes.io/audit: "restricted"
    pod-security.kubernetes.io/warn: "restricted"
  annotations:
    adversary-lab/description: "Security assessment — Kubescape, rbac-police, vulnerability scanners"
    adversary-lab/mitre-tactics: "Discovery technique validation (T1613, T1069)"
